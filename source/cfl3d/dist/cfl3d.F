      subroutine cfl3d(mwork,mworki,nplots,minnode,iitot,intmax,
     .                 maxxe,mxbli,nsub1,lbcprd,lbcemb,lbcrad,maxbl,
     .                 maxgr,maxseg,maxcs,ncycmax,intmx,mxxe,mptch,
     .                 msub1,ibufdim,nbuf,mxbcfil,istat_size,ntr,
     .                 nmds,maxaes,nslave,maxsegdg,nmaster,bcfiles,
     .                 bou,nou)
c***********************************************************************
c     Purpose:  Allocate memory and execute flow solver
c***********************************************************************
c
#   ifdef CMPLX
      implicit complex(a-h,o-z)
#   endif
c
#if defined DIST_MPI
c
#     include "mpif.h"
#   ifdef DBLE_PRECSN
#      ifdef CMPLX
#        define MY_MPI_REAL MPI_DOUBLE_COMPLEX
#      else
#        define MY_MPI_REAL MPI_DOUBLE_PRECISION
#      endif
#   else
#      ifdef CMPLX
#        define MY_MPI_REAL MPI_COMPLEX
#      else
#        define MY_MPI_REAL MPI_REAL
#      endif
#   endif
      dimension istat(MPI_STATUS_SIZE)
#endif
c
      character*80 bcfiles(mxbcfil)
      character*120 bou(ibufdim,nbuf)
c
      integer lout,xif1,xif2,etf1,etf2
      integer bcfilei,bcfilej,bcfilek
c
      dimension bcfilei(maxbl,maxseg,2),bcfilej(maxbl,maxseg,2),
     .          bcfilek(maxbl,maxseg,2)
      dimension istat2_bl(istat_size,mxbli*5),
     .          istat2_pa(istat_size,intmax*nsub1*3),
     .          istat2_em(istat_size,lbcemb*3),
     .          istat2_pe(istat_size,lbcprd*5)
      dimension nou(nbuf)
      dimension work(mwork),iwork(mworki),lwdat(maxbl,maxseg,6)
      dimension lw(65,maxbl),lw2(43,maxbl)
      dimension nblk(2,mxbli),limblk(2,6,mxbli),
     .          isva(2,2,mxbli),nblon(mxbli)
      dimension resmx(maxbl),imx(maxbl),jmx(maxbl),kmx(maxbl)
      dimension vormax(maxbl),ivmax(maxbl),jvmax(maxbl),kvmax(maxbl)
      dimension lig(maxbl),lbg(maxbl),iovrlp(maxbl),qb(iitot,5,3)
      dimension ibpntsg(maxbl,4),iipntsg(maxbl)
      dimension iibg(iitot),kkbg(iitot),jjbg(iitot),ibcg(iitot)
      dimension dxintg(iitot),dyintg(iitot),dzintg(iitot),
     .          iiig(iitot),jjig(iitot),kkig(iitot)
      dimension rkap0g(maxbl,3),levelg(maxbl),igridg(maxbl),
     .          iflimg(maxbl,3),ifdsg(maxbl,3),iviscg(maxbl,3),
     .          jdimg(maxbl),kdimg(maxbl),idimg(maxbl),idiagg(maxbl,3),
     .          nblcg(maxbl),idegg(maxbl,3),
     .          jsg(maxbl),ksg(maxbl),isg(maxbl),jeg(maxbl),keg(maxbl),
     .          ieg(maxbl),mit(5,maxbl),ilamlog(maxbl),ilamhig(maxbl),
     .          jlamlog(maxbl),jlamhig(maxbl),klamlog(maxbl),
     .          klamhig(maxbl),iwfg(maxbl,3)
      dimension utrans(maxbl),vtrans(maxbl),wtrans(maxbl),
     .          omegax(maxbl),omegay(maxbl),omegaz(maxbl),xorig(maxbl),
     .          yorig(maxbl),zorig(maxbl),dxmx(maxbl),dymx(maxbl),
     .          dzmx(maxbl),dthxmx(maxbl),dthymx(maxbl),dthzmx(maxbl),
     .          thetax(maxbl),thetay(maxbl),thetaz(maxbl),rfreqt(maxbl),
     .          rfreqr(maxbl),xorig0(maxbl),yorig0(maxbl),zorig0(maxbl),
     .          time2(maxbl),thetaxl(maxbl),thetayl(maxbl),
     .          thetazl(maxbl),itrans(maxbl),irotat(maxbl),idefrm(maxbl)
      dimension bcvali(maxbl,maxseg,7,2),
     .          bcvalj(maxbl,maxseg,7,2),bcvalk(maxbl,maxseg,7,2),
     .          nbci0(maxbl),nbcidim(maxbl),nbcj0(maxbl),nbcjdim(maxbl),
     .          nbck0(maxbl),nbckdim(maxbl),ibcinfo(maxbl,maxseg,7,2),
     .          jbcinfo(maxbl,maxseg,7,2),kbcinfo(maxbl,maxseg,7,2)
      dimension ncgg(maxgr),nblg(maxgr),iemg(maxgr),inewgg(maxgr)
      dimension inpl3d(nplots,11),inpr(nplots,11)
      dimension iadvance(maxbl),iforce(maxbl)
      dimension rms(ncycmax),clw(ncycmax),
     .          cdw(ncycmax),cdpw(ncycmax),cdvw(ncycmax),
     .          cxw(ncycmax),cyw(ncycmax),czw(ncycmax),
     .          cmxw(ncycmax),cmyw(ncycmax),cmzw(ncycmax),
     .          chdw(ncycmax),swetw(ncycmax),
     .          fmdotw(ncycmax),cfttotw(ncycmax),
     .          cftmomw(ncycmax),cftpw(ncycmax),cftvw(ncycmax),
     .          rmstr1(ncycmax),rmstr2(ncycmax),
     .          nneg1(ncycmax),nneg2(ncycmax),timekeep(ncycmax)
      dimension swett(maxbl),clt(maxbl),cdt(maxbl),cxt(maxbl),
     .          cyt(maxbl),czt(maxbl),cmxt(maxbl),cmyt(maxbl),
     .          cmzt(maxbl),cdpt(maxbl),cdvt(maxbl)
      dimension sx(maxcs),sy(maxcs),sz(maxcs),stot(maxcs),
     .          pav(maxcs),ptav(maxcs),tav(maxcs),ttav(maxcs),
     .          xmav(maxcs),fmdot(maxcs),
     .          cfxp(maxcs),cfyp(maxcs),cfzp(maxcs),
     .          cfdp(maxcs),cflp(maxcs),cftp(maxcs),
     .          cfxv(maxcs),cfyv(maxcs),cfzv(maxcs),
     .          cfdv(maxcs),cflv(maxcs),cftv(maxcs),
     .          cfxmom(maxcs),cfymom(maxcs),cfzmom(maxcs),
     .          cfdmom(maxcs),cflmom(maxcs),cftmom(maxcs),
     .          cfxtot(maxcs),cfytot(maxcs),cfztot(maxcs),
     .          cfdtot(maxcs),cfltot(maxcs),cfttot(maxcs),
     .          icsinfo(maxcs,9)
      dimension windex(maxxe,2),iindex(intmax,6*nsub1+9),
     .          nblkpt(maxxe)
      dimension windx(mxxe,2),iindx(intmx,6*msub1+9),
     .          llimit(intmx),iitmax(intmx),mmcxie(intmx),
     .          mmceta(intmx),ncheck(maxbl),iifit(intmx),
     .          mblkpt(mxxe),iic0(intmx),iiorph(intmx),iitoss(intmx),
     .          ifiner(intmx)
      dimension dthetxx(intmax,nsub1),dthetyy(intmax,nsub1),
     .          dthetzz(intmax,nsub1)
      dimension dx(intmx,msub1),dy(intmx,msub1),dz(intmx,msub1),
     .          dthetx(intmx,msub1),dthety(intmx,msub1),
     .          dthetz(intmx,msub1)
      dimension lout(msub1),xif1(msub1),xif2(msub1),etf1(msub1),
     .          etf2(msub1),jjmax1(nsub1),kkmax1(nsub1),iiint1(nsub1),
     .          iiint2(nsub1),jimage(msub1,mptch+2,mptch+2),
     .          kimage(msub1,mptch+2,mptch+2),jte(msub1),kte(msub1),
     .          jmm(mptch+2),kmm(mptch+2),nblk1(mptch+2),nblk2(mptch+2),
     .          xte(mptch+2,mptch+2,msub1),yte(mptch+2,mptch+2,msub1),
     .          zte(mptch+2,mptch+2,msub1),xmi(mptch+2,mptch+2,msub1),
     .          ymi(mptch+2,mptch+2,msub1),zmi(mptch+2,mptch+2,msub1),
     .          xmie(mptch+2,mptch+2,msub1),ymie(mptch+2,mptch+2,msub1),
     .          zmie(mptch+2,mptch+2,msub1),sxie(mptch+2,mptch+2,msub1),
     .          seta(mptch+2,mptch+2,msub1),sxie2(mptch+2,mptch+2),
     .          seta2(mptch+2,mptch+2),xie2s(mptch+2,mptch+2),
     .          eta2s(mptch+2,mptch+2),temp((mptch+2)*(mptch+2)),
     .          x2(mptch+2,mptch+2),y2(mptch+2,mptch+2),
     .          z2(mptch+2,mptch+2),x1(mptch+2,mptch+2),
     .          y1(mptch+2,mptch+2),z1(mptch+2,mptch+2),
     .          factjlo(intmx,msub1),factjhi(intmx,msub1),
     .          factklo(intmx,msub1),factkhi(intmx,msub1),ifrom(msub1)
      dimension geom_miss(2*mxbli),period_miss(lbcprd)
      dimension isav_blk(2*mxbli,17)
      dimension isav_prd(lbcprd,12)
      dimension isav_pat(intmax,17),isav_pat_b(intmax,nsub1,6)
      dimension isav_dpat(intmx,17),isav_dpat_b(intmx,msub1,6)
      dimension isav_emb(lbcemb,12)
      dimension mblk2nd(maxbl)
      dimension utrnsae(maxbl,maxsegdg),vtrnsae(maxbl,maxsegdg),
     .          wtrnsae(maxbl,maxsegdg),omgxae(maxbl,maxsegdg),
     .          omgyae(maxbl,maxsegdg),omgzae(maxbl,maxsegdg),
     .          xorgae(maxbl,maxsegdg),yorgae(maxbl,maxsegdg),
     .          zorgae(maxbl,maxsegdg),thtxae(maxbl,maxsegdg),
     .          thtyae(maxbl,maxsegdg),thtzae(maxbl,maxsegdg),
     .          rfrqtae(maxbl,maxsegdg),rfrqrae(maxbl,maxsegdg)
      dimension xorgae0(maxbl,maxsegdg),yorgae0(maxbl,maxsegdg),
     .          zorgae0(maxbl,maxsegdg),icouple(maxbl,maxsegdg)
      dimension icsi(maxbl,maxsegdg),icsf(maxbl,maxsegdg),
     .          jcsi(maxbl,maxsegdg),jcsf(maxbl,maxsegdg),
     .          kcsi(maxbl,maxsegdg),kcsf(maxbl,maxsegdg)
      dimension nsegdfrm(maxbl),idfrmseg(maxbl,maxsegdg),
     .          iaesurf(maxbl,maxsegdg)
      dimension freq(nmds,maxaes),gmass(nmds,maxaes),x0(2*nmds,maxaes),
     .          gf0(2*nmds,maxaes),damp(nmds,maxaes),
     .          perturb(nmds,maxaes,4),aehist(ncycmax,3,nmds,maxaes)
      dimension aesrfdat(5,maxaes),slavept(nslave,3,nmaster,5)
      dimension iskip(maxbl),jskip(maxbl),kskip(maxbl)
      dimension bmat(2*nmds,2*nmds,maxaes),gforcn(2*nmds,maxaes),
     .          gforcnm(2*nmds,maxaes),gforcs(2*nmds,maxaes),
     .          stm(2*nmds,2*nmds,maxaes),stmi(2*nmds,2*nmds,maxaes),
     .          xs(2*nmds,maxaes),xxn(2*nmds,maxaes)
c
      pointer (ip_work,work),(ip_iwork,iwork),(ip_lwdat,lwdat)
      pointer (ip_lw,lw),(ip_lw2,lw2)
      pointer (ip_nblk,nblk),(ip_limblk,limblk),
     .        (ip_isva,isva),(ip_nblon,nblon)
      pointer (ip_resmx,resmx),(ip_imx,imx),(ip_jmx,jmx),(ip_kmx,kmx)
      pointer (ip_vormax,vormax),(ip_ivmax,ivmax),(ip_jvmax,jvmax),
     .        (ip_kvmax,kvmax)
      pointer (ip_lig,lig),(ip_lbg,lbg),(ip_iovrlp,iovrlp),(ip_qb,qb)
      pointer (ip_ibpntsg,ibpntsg),(ip_iipntsg,iipntsg)
      pointer (ip_iibg,iibg),(ip_kkbg,kkbg),(ip_jjbg,jjbg),
     .        (ip_ibcg,ibcg)
      pointer (ip_dxintg,dxintg),(ip_dyintg,dyintg),(ip_dzintg,dzintg),
     .        (ip_iiig,iiig),(ip_jjig,jjig),(ip_kkig,kkig)
      pointer (ip_rkap0g,rkap0g),(ip_levelg,levelg),(ip_igridg,igridg),
     .        (ip_iflimg,iflimg),(ip_ifdsg,ifdsg),(ip_iviscg,iviscg),
     .        (ip_jdimg,jdimg),(ip_kdimg,kdimg),(ip_idimg,idimg),
     .        (ip_idiagg,idiagg),(ip_nblcg,nblcg),(ip_idegg,idegg),
     .        (ip_jsg,jsg),(ip_ksg,ksg),(ip_isg,isg),(ip_jeg,jeg),
     .        (ip_keg,keg),(ip_ieg,ieg),(ip_mit,mit),
     .        (ip_ilamlog,ilamlog),(ip_ilamhig,ilamhig),
     .        (ip_jlamlog,jlamlog),(ip_jlamhig,jlamhig),
     .        (ip_klamlog,klamlog),(ip_klamhig,klamhig),(ip_iwfg,iwfg)
      pointer (ip_utrans,utrans),(ip_vtrans,vtrans),(ip_wtrans,wtrans),
     .        (ip_omegax,omegax),(ip_omegay,omegay),(ip_omegaz,omegaz),
     .        (ip_xorig,xorig),(ip_yorig,yorig),(ip_zorig,zorig),
     .        (ip_dxmx,dxmx),(ip_dymx,dymx),
     .        (ip_dzmx,dzmx),(ip_dthxmx,dthxmx),(ip_dthymx,dthymx),
     .        (ip_dthzmx,dthzmx),(ip_thetax,thetax),(ip_thetay,thetay),
     .        (ip_thetaz,thetaz),(ip_rfreqt,rfreqt),
     .        (ip_rfreqr,rfreqr),(ip_xorig0,xorig0),(ip_yorig0,yorig0),
     .        (ip_zorig0,zorig0),(ip_time2,time2),(ip_thetaxl,thetaxl),
     .        (ip_thetayl,thetayl),(ip_thetazl,thetazl),
     .        (ip_itrans,itrans),(ip_irotat,irotat),(ip_idefrm,idefrm)
      pointer (ip_bcvali,bcvali),(ip_bcvalj,bcvalj),
     .        (ip_bcvalk,bcvalk),(ip_nbci0,nbci0),
     .        (ip_nbcidim,nbcidim),(ip_nbcj0,nbcj0),
     .        (ip_nbcjdim,nbcjdim),(ip_nbck0,nbck0),
     .        (ip_nbckdim,nbckdim),(ip_ibcinfo,ibcinfo),
     .        (ip_jbcinfo,jbcinfo),(ip_kbcinfo,kbcinfo)
      pointer (ip_bcfilei,bcfilei),(ip_bcfilej,bcfilej),
     .        (ip_bcfilek,bcfilek)
      pointer (ip_ncgg,ncgg),(ip_nblg,nblg),(ip_iemg,iemg),
     .        (ip_inewgg,inewgg)
      pointer (ip_inpl3d,inpl3d),(ip_inpr,inpr)
      pointer (ip_iadvance,iadvance),(ip_iforce,iforce)
      pointer (ip_rms,rms),(ip_clw,clw),
     .        (ip_cdw,cdw),(ip_cdpw,cdpw),(ip_cdvw,cdvw),
     .        (ip_cxw,cxw),(ip_cyw,cyw),(ip_czw,czw),
     .        (ip_cmxw,cmxw),(ip_cmyw,cmyw),(ip_cmzw,cmzw),
     .        (ip_chdw,chdw),(ip_swetw,swetw),
     .        (ip_fmdotw,fmdotw),(ip_cfttotw,cfttotw),
     .        (ip_cftmomw,cftmomw),(ip_cftpw,cftpw),(ip_cftvw,cftvw),
     .        (ip_rmstr1,rmstr1),(ip_rmstr2,rmstr2),
     .        (ip_nneg1,nneg1),(ip_nneg2,nneg2),(ip_timekeep,timekeep)
      pointer (ip_swett,swett),(ip_clt,clt),(ip_cdt,cdt),(ip_cxt,cxt),
     .        (ip_cyt,cyt),(ip_czt,czt),(ip_cmxt,cmxt),(ip_cmyt,cmyt),
     .        (ip_cmzt,cmzt),(ip_cdpt,cdpt),(ip_cdvt,cdvt)
      pointer (ip_sx,sx),(ip_sy,sy),(ip_sz,sz),(ip_stot,stot),
     .        (ip_pav,pav),(ip_ptav,ptav),(ip_tav,tav),(ip_ttav,ttav),
     .        (ip_xmav,xmav),(ip_fmdot,fmdot),
     .        (ip_cfxp,cfxp),(ip_cfyp,cfyp),(ip_cfzp,cfzp),
     .        (ip_cfdp,cfdp),(ip_cflp,cflp),(ip_cftp,cftp),
     .        (ip_cfxv,cfxv),(ip_cfyv,cfyv),(ip_cfzv,cfzv),
     .        (ip_cfdv,cfdv),(ip_cflv,cflv),(ip_cftv,cftv),
     .        (ip_cfxmom,cfxmom),(ip_cfymom,cfymom),(ip_cfzmom,cfzmom),
     .        (ip_cfdmom,cfdmom),(ip_cflmom,cflmom),(ip_cftmom,cftmom),
     .        (ip_cfxtot,cfxtot),(ip_cfytot,cfytot),(ip_cfztot,cfztot),
     .        (ip_cfdtot,cfdtot),(ip_cfltot,cfltot),(ip_cfttot,cfttot),
     .        (ip_icsinfo,icsinfo)
      pointer (ip_windex,windex),(ip_iindex,iindex),
     .        (ip_nblkpt,nblkpt)
      pointer (ip_windx,windx),(ip_iindx,iindx),
     .        (ip_llimit,llimit),(ip_iitmax,iitmax),(ip_mmcxie,mmcxie),
     .        (ip_mmceta,mmceta),(ip_ncheck,ncheck),(ip_iifit,iifit),
     .        (ip_mblkpt,mblkpt),(ip_iic0,iic0),(ip_iiorph,iiorph),
     .        (ip_iitoss,iitoss),(ip_ifiner,ifiner)
      pointer (ip_dthetxx,dthetxx),(ip_dthetyy,dthetyy),
     .        (ip_dthetzz,dthetzz)
      pointer (ip_dx,dx),(ip_dy,dy),(ip_dz,dz),
     .        (ip_dthetx,dthetx),(ip_dthety,dthety),
     .        (ip_dthetz,dthetz)
      pointer (ip_lout,lout),(ip_xif1,xif1),(ip_xif2,xif2),
     .        (ip_etf1,etf1),(ip_etf2,etf2),
     .        (ip_jjmax1,jjmax1),(ip_kkmax1,kkmax1),(ip_iiint1,iiint1),
     .        (ip_iiint2,iiint2),(ip_jimage,jimage),
     .        (ip_kimage,kimage),(ip_jte,jte),(ip_kte,kte),
     .        (ip_jmm,jmm),(ip_kmm,kmm),(ip_nblk1,nblk1),
     .        (ip_nblk2,nblk2),(ip_xte,xte),(ip_yte,yte),
     .        (ip_zte,zte),(ip_xmi,xmi),
     .        (ip_ymi,ymi),(ip_zmi,zmi),
     .        (ip_xmie,xmie),(ip_ymie,ymie),
     .        (ip_zmie,zmie),(ip_sxie,sxie),
     .        (ip_seta,seta),(ip_sxie2,sxie2),
     .        (ip_seta2,seta2),(ip_xie2s,xie2s),
     .        (ip_eta2s,eta2s),(ip_temp,temp),
     .        (ip_x2,x2),(ip_y2,y2),
     .        (ip_z2,z2),(ip_x1,x1),
     .        (ip_y1,y1),(ip_z1,z1),
     .        (ip_factjlo,factjlo),(ip_factjhi,factjhi),
     .        (ip_factklo,factklo),(ip_factkhi,factkhi),
     .        (ip_ifrom,ifrom)
      pointer (ip_geom_miss,geom_miss),(ip_period_miss,period_miss)
      pointer (ip_isav_blk,isav_blk)
      pointer (ip_isav_prd,isav_prd)
      pointer (ip_isav_pat,isav_pat),(ip_isav_pat_b,isav_pat_b)
      pointer (ip_isav_dpat,isav_dpat),(ip_isav_dpat_b,isav_dpat_b)
      pointer (ip_isav_emb,isav_emb)
      pointer (ip_mblk2nd,mblk2nd)
      pointer (ip_istat2_bl,istat2_bl),(ip_istat2_pa,istat2_pa),
     .        (ip_istat2_em,istat2_em),(ip_istat2_pe,istat2_pe)
      pointer (ip_aesrfdat,aesrfdat),(ip_utrnsae,utrnsae),
     .        (ip_vtrnsae,vtrnsae),(ip_wtrnsae,wtrnsae),
     .        (ip_omgxae,omgxae),(ip_omgyae,omgyae),(ip_omgzae,omgzae),
     .        (ip_xorgae,xorgae),(ip_yorgae,yorgae),(ip_zorgae,zorgae),
     .        (ip_xorgae0,xorgae0),(ip_yorgae0,yorgae0),
     .        (ip_zorgae0,zorgae0),(ip_icouple,icouple),
     .        (ip_thtxae,thtxae),(ip_thtyae,thtyae),(ip_thtzae,thtzae),
     .        (ip_rfrqtae,rfrqtae),(ip_rfrqrae,rfrqrae),(ip_icsi,icsi),
     .        (ip_icsf,icsf),(ip_jcsi,jcsi),(ip_jcsf,jcsf),
     .        (ip_kcsi,kcsi),(ip_kcsf,kcsf),(ip_freq,freq),
     .        (ip_gmass,gmass),(ip_damp,damp),(ip_x0,x0),(ip_gf0,gf0),
     .        (ip_perturb,perturb),(ip_slavept,slavept),
     .        (ip_iskip,iskip),(ip_jskip,jskip),(ip_kskip,kskip),
     .        (ip_bmat,bmat),(ip_stm,stm),(ip_stmi,stmi),(ip_xs,xs),
     .        (ip_xxn,xxn),(ip_gforcn,gforcn),(ip_gforcnm,gforcnm),
     .        (ip_gforcs,gforcs),(ip_nsegdfrm,nsegdfrm),
     .        (ip_idfrmseg,idfrmseg),(ip_iaesurf,iaesurf),
     .        (ip_aehist,aehist)
c
c     keep work array pointers in common to avoid "stacksize limit"
c     problems on SGIs
c
      common /wrk/ ip_work
      common /wrki/ ip_iwork
c
      common /mydist2/ nnodes,myhost,myid,mycomm
c
c***********************************************************************
c     memory allocation
c***********************************************************************
c
      icall  = 0
      memuse = 0
c
      call umalloc(ip_work,mwork,0,icall,memuse)
      call umalloc(ip_iwork,mworki,1,icall,memuse)
      call umalloc(ip_lwdat,maxbl*maxseg*6,1,icall,memuse)
      call umalloc(ip_lw,65*maxbl,1,icall,memuse)
      call umalloc(ip_lw2,43*maxbl,1,icall,memuse)
      call umalloc(ip_nblk,2*mxbli,1,icall,memuse)
      call umalloc(ip_limblk,12*mxbli,1,icall,memuse)
      call umalloc(ip_isva,4*mxbli,1,icall,memuse)
      call umalloc(ip_nblon,mxbli,1,icall,memuse)
      call umalloc(ip_resmx,maxbl,0,icall,memuse)
      call umalloc(ip_imx,maxbl,1,icall,memuse)
      call umalloc(ip_jmx,maxbl,1,icall,memuse)
      call umalloc(ip_kmx,maxbl,1,icall,memuse)
      call umalloc(ip_vormax,maxbl,0,icall,memuse)
      call umalloc(ip_ivmax,maxbl,1,icall,memuse)
      call umalloc(ip_jvmax,maxbl,1,icall,memuse)
      call umalloc(ip_kvmax,maxbl,1,icall,memuse)
      call umalloc(ip_lig,maxbl,1,icall,memuse)
      call umalloc(ip_lbg,maxbl,1,icall,memuse)
      call umalloc(ip_iovrlp,maxbl,1,icall,memuse)
      call umalloc(ip_qb,15*iitot,0,icall,memuse)
      call umalloc(ip_ibpntsg,4*maxbl,1,icall,memuse)
      call umalloc(ip_iipntsg,maxbl,1,icall,memuse)
      call umalloc(ip_iibg,iitot,1,icall,memuse)
      call umalloc(ip_jjbg,iitot,1,icall,memuse)
      call umalloc(ip_kkbg,iitot,1,icall,memuse)
      call umalloc(ip_ibcg,iitot,1,icall,memuse)
      call umalloc(ip_dxintg,iitot,0,icall,memuse)
      call umalloc(ip_dyintg,iitot,0,icall,memuse)
      call umalloc(ip_dzintg,iitot,0,icall,memuse)
      call umalloc(ip_iiig,iitot,1,icall,memuse)
      call umalloc(ip_jjig,iitot,1,icall,memuse)
      call umalloc(ip_kkig,iitot,1,icall,memuse)
      call umalloc(ip_rkap0g,3*maxbl,0,icall,memuse)
      call umalloc(ip_levelg,maxbl,1,icall,memuse)
      call umalloc(ip_igridg,maxbl,1,icall,memuse)
      call umalloc(ip_iflimg,3*maxbl,1,icall,memuse)
      call umalloc(ip_ifdsg,3*maxbl,1,icall,memuse)
      call umalloc(ip_iviscg,3*maxbl,1,icall,memuse)
      call umalloc(ip_jdimg,maxbl,1,icall,memuse)
      call umalloc(ip_kdimg,maxbl,1,icall,memuse)
      call umalloc(ip_idimg,maxbl,1,icall,memuse)
      call umalloc(ip_idiagg,3*maxbl,1,icall,memuse)
      call umalloc(ip_nblcg,maxbl,1,icall,memuse)
      call umalloc(ip_idegg,3*maxbl,1,icall,memuse)
      call umalloc(ip_jsg,maxbl,1,icall,memuse)
      call umalloc(ip_ksg,maxbl,1,icall,memuse)
      call umalloc(ip_isg,maxbl,1,icall,memuse)
      call umalloc(ip_jeg,maxbl,1,icall,memuse)
      call umalloc(ip_keg,maxbl,1,icall,memuse)
      call umalloc(ip_ieg,maxbl,1,icall,memuse)
      call umalloc(ip_mit,5*maxbl,1,icall,memuse)
      call umalloc(ip_jlamlog,maxbl,1,icall,memuse)
      call umalloc(ip_klamlog,maxbl,1,icall,memuse)
      call umalloc(ip_ilamlog,maxbl,1,icall,memuse)
      call umalloc(ip_jlamhig,maxbl,1,icall,memuse)
      call umalloc(ip_klamhig,maxbl,1,icall,memuse)
      call umalloc(ip_ilamhig,maxbl,1,icall,memuse)
      call umalloc(ip_iwfg,3*maxbl,1,icall,memuse)
      call umalloc(ip_utrans,maxbl,0,icall,memuse)
      call umalloc(ip_vtrans,maxbl,0,icall,memuse)
      call umalloc(ip_wtrans,maxbl,0,icall,memuse)
      call umalloc(ip_omegax,maxbl,0,icall,memuse)
      call umalloc(ip_omegay,maxbl,0,icall,memuse)
      call umalloc(ip_omegaz,maxbl,0,icall,memuse)
      call umalloc(ip_xorig,maxbl,0,icall,memuse)
      call umalloc(ip_yorig,maxbl,0,icall,memuse)
      call umalloc(ip_zorig,maxbl,0,icall,memuse)
      call umalloc(ip_dxmx,maxbl,0,icall,memuse)
      call umalloc(ip_dymx,maxbl,0,icall,memuse)
      call umalloc(ip_dzmx,maxbl,0,icall,memuse)
      call umalloc(ip_dthxmx,maxbl,0,icall,memuse)
      call umalloc(ip_dthymx,maxbl,0,icall,memuse)
      call umalloc(ip_dthzmx,maxbl,0,icall,memuse)
      call umalloc(ip_thetax,maxbl,0,icall,memuse)
      call umalloc(ip_thetay,maxbl,0,icall,memuse)
      call umalloc(ip_thetaz,maxbl,0,icall,memuse)
      call umalloc(ip_rfreqt,maxbl,0,icall,memuse)
      call umalloc(ip_rfreqr,maxbl,0,icall,memuse)
      call umalloc(ip_xorig0,maxbl,0,icall,memuse)
      call umalloc(ip_yorig0,maxbl,0,icall,memuse)
      call umalloc(ip_zorig0,maxbl,0,icall,memuse)
      call umalloc(ip_time2,maxbl,0,icall,memuse)
      call umalloc(ip_thetaxl,maxbl,0,icall,memuse)
      call umalloc(ip_thetayl,maxbl,0,icall,memuse)
      call umalloc(ip_thetazl,maxbl,0,icall,memuse)
      call umalloc(ip_itrans,maxbl,1,icall,memuse)
      call umalloc(ip_irotat,maxbl,1,icall,memuse)
      call umalloc(ip_idefrm,maxbl,1,icall,memuse)
      call umalloc(ip_bcvali,14*maxseg*maxbl,0,icall,memuse)
      call umalloc(ip_bcvalj,14*maxseg*maxbl,0,icall,memuse)
      call umalloc(ip_bcvalk,14*maxseg*maxbl,0,icall,memuse)
      call umalloc(ip_nbci0,maxbl,1,icall,memuse)
      call umalloc(ip_nbcj0,maxbl,1,icall,memuse)
      call umalloc(ip_nbck0,maxbl,1,icall,memuse)
      call umalloc(ip_nbcidim,maxbl,1,icall,memuse)
      call umalloc(ip_nbcjdim,maxbl,1,icall,memuse)
      call umalloc(ip_nbckdim,maxbl,1,icall,memuse)
      call umalloc(ip_ibcinfo,14*maxseg*maxbl,1,icall,memuse)
      call umalloc(ip_jbcinfo,14*maxseg*maxbl,1,icall,memuse)
      call umalloc(ip_kbcinfo,14*maxseg*maxbl,1,icall,memuse)
      call umalloc(ip_bcfilei,2*maxseg*maxbl,1,icall,memuse)
      call umalloc(ip_bcfilej,2*maxseg*maxbl,1,icall,memuse)
      call umalloc(ip_bcfilek,2*maxseg*maxbl,1,icall,memuse)
      call umalloc(ip_ncgg,maxgr,1,icall,memuse)
      call umalloc(ip_nblg,maxgr,1,icall,memuse)
      call umalloc(ip_iemg,maxgr,1,icall,memuse)
      call umalloc(ip_inewgg,maxgr,1,icall,memuse)
      call umalloc(ip_inpl3d,11*nplots,1,icall,memuse)
      call umalloc(ip_inpr,11*nplots,1,icall,memuse)
      call umalloc(ip_iadvance,maxbl,1,icall,memuse)
      call umalloc(ip_iforce,maxbl,1,icall,memuse)
      call umalloc(ip_rms,ncycmax,0,icall,memuse)
      call umalloc(ip_clw,ncycmax,0,icall,memuse)
      call umalloc(ip_cdw,ncycmax,0,icall,memuse)
      call umalloc(ip_cdpw,ncycmax,0,icall,memuse)
      call umalloc(ip_cdvw,ncycmax,0,icall,memuse)
      call umalloc(ip_cxw,ncycmax,0,icall,memuse)
      call umalloc(ip_cyw,ncycmax,0,icall,memuse)
      call umalloc(ip_czw,ncycmax,0,icall,memuse)
      call umalloc(ip_cmxw,ncycmax,0,icall,memuse)
      call umalloc(ip_cmyw,ncycmax,0,icall,memuse)
      call umalloc(ip_cmzw,ncycmax,0,icall,memuse)
      call umalloc(ip_chdw,ncycmax,0,icall,memuse)
      call umalloc(ip_swetw,ncycmax,0,icall,memuse)
      call umalloc(ip_fmdotw,ncycmax,0,icall,memuse)
      call umalloc(ip_cfttotw,ncycmax,0,icall,memuse)
      call umalloc(ip_cftmomw,ncycmax,0,icall,memuse)
      call umalloc(ip_cftpw,ncycmax,0,icall,memuse)
      call umalloc(ip_cftvw,ncycmax,0,icall,memuse)
      call umalloc(ip_rmstr1,ncycmax,0,icall,memuse)
      call umalloc(ip_rmstr2,ncycmax,0,icall,memuse)
      call umalloc(ip_nneg1,ncycmax,1,icall,memuse)
      call umalloc(ip_nneg2,ncycmax,1,icall,memuse)
      call umalloc(ip_swett,maxbl,0,icall,memuse)
      call umalloc(ip_clt,maxbl,0,icall,memuse)
      call umalloc(ip_cdt,maxbl,0,icall,memuse)
      call umalloc(ip_cxt,maxbl,0,icall,memuse)
      call umalloc(ip_cyt,maxbl,0,icall,memuse)
      call umalloc(ip_czt,maxbl,0,icall,memuse)
      call umalloc(ip_cmxt,maxbl,0,icall,memuse)
      call umalloc(ip_cmyt,maxbl,0,icall,memuse)
      call umalloc(ip_cmzt,maxbl,0,icall,memuse)
      call umalloc(ip_cdpt,maxbl,0,icall,memuse)
      call umalloc(ip_cdvt,maxbl,0,icall,memuse)
      call umalloc(ip_sx,maxcs,0,icall,memuse)
      call umalloc(ip_sy,maxcs,0,icall,memuse)
      call umalloc(ip_sz,maxcs,0,icall,memuse)
      call umalloc(ip_stot,maxcs,0,icall,memuse)
      call umalloc(ip_pav,maxcs,0,icall,memuse)
      call umalloc(ip_ptav,maxcs,0,icall,memuse)
      call umalloc(ip_tav,maxcs,0,icall,memuse)
      call umalloc(ip_ttav,maxcs,0,icall,memuse)
      call umalloc(ip_xmav,maxcs,0,icall,memuse)
      call umalloc(ip_fmdot,maxcs,0,icall,memuse)
      call umalloc(ip_cfxp,maxcs,0,icall,memuse)
      call umalloc(ip_cfyp,maxcs,0,icall,memuse)
      call umalloc(ip_cfzp,maxcs,0,icall,memuse)
      call umalloc(ip_cfdp,maxcs,0,icall,memuse)
      call umalloc(ip_cflp,maxcs,0,icall,memuse)
      call umalloc(ip_cftp,maxcs,0,icall,memuse)
      call umalloc(ip_cfxv,maxcs,0,icall,memuse)
      call umalloc(ip_cfyv,maxcs,0,icall,memuse)
      call umalloc(ip_cfzv,maxcs,0,icall,memuse)
      call umalloc(ip_cfdv,maxcs,0,icall,memuse)
      call umalloc(ip_cflv,maxcs,0,icall,memuse)
      call umalloc(ip_cftv,maxcs,0,icall,memuse)
      call umalloc(ip_cfxmom,maxcs,0,icall,memuse)
      call umalloc(ip_cfymom,maxcs,0,icall,memuse)
      call umalloc(ip_cfzmom,maxcs,0,icall,memuse)
      call umalloc(ip_cfdmom,maxcs,0,icall,memuse)
      call umalloc(ip_cflmom,maxcs,0,icall,memuse)
      call umalloc(ip_cftmom,maxcs,0,icall,memuse)
      call umalloc(ip_cfxtot,maxcs,0,icall,memuse)
      call umalloc(ip_cfytot,maxcs,0,icall,memuse)
      call umalloc(ip_cfztot,maxcs,0,icall,memuse)
      call umalloc(ip_cfdtot,maxcs,0,icall,memuse)
      call umalloc(ip_cfltot,maxcs,0,icall,memuse)
      call umalloc(ip_cfttot,maxcs,0,icall,memuse)
      call umalloc(ip_icsinfo,9*maxcs,1,icall,memuse)
      call umalloc(ip_windex,2*maxxe,0,icall,memuse)
      call umalloc(ip_iindex,intmax*(6*nsub1+9),1,icall,memuse)
      call umalloc(ip_nblkpt,maxxe,1,icall,memuse)
      call umalloc(ip_windx,2*mxxe,0,icall,memuse)
      call umalloc(ip_iindx,intmx*(6*msub1+9),1,icall,memuse)
      call umalloc(ip_llimit,intmx,1,icall,memuse)
      call umalloc(ip_iitmax,intmx,1,icall,memuse)
      call umalloc(ip_mmcxie,intmx,1,icall,memuse)
      call umalloc(ip_mmceta,intmx,1,icall,memuse)
      call umalloc(ip_ncheck,maxbl,1,icall,memuse)
      call umalloc(ip_iifit,intmx,1,icall,memuse)
      call umalloc(ip_mblkpt,mxxe,1,icall,memuse)
      call umalloc(ip_iic0,intmx,1,icall,memuse)
      call umalloc(ip_iiorph,intmx,1,icall,memuse)
      call umalloc(ip_iitoss,intmx,1,icall,memuse)
      call umalloc(ip_ifiner,intmx,1,icall,memuse)
      call umalloc(ip_dthetxx,intmax*nsub1,0,icall,memuse)
      call umalloc(ip_dthetyy,intmax*nsub1,0,icall,memuse)
      call umalloc(ip_dthetzz,intmax*nsub1,0,icall,memuse)
      call umalloc(ip_dx,intmx*msub1,0,icall,memuse)
      call umalloc(ip_dy,intmx*msub1,0,icall,memuse)
      call umalloc(ip_dz,intmx*msub1,0,icall,memuse)
      call umalloc(ip_dthetx,intmx*msub1,0,icall,memuse)
      call umalloc(ip_dthety,intmx*msub1,0,icall,memuse)
      call umalloc(ip_dthetz,intmx*msub1,0,icall,memuse)
      call umalloc(ip_lout,msub1,1,icall,memuse)
      call umalloc(ip_xif1,msub1,1,icall,memuse)
      call umalloc(ip_xif2,msub1,1,icall,memuse)
      call umalloc(ip_etf1,msub1,1,icall,memuse)
      call umalloc(ip_etf2,msub1,1,icall,memuse)
      call umalloc(ip_jjmax1,nsub1,1,icall,memuse)
      call umalloc(ip_kkmax1,nsub1,1,icall,memuse)
      call umalloc(ip_iiint1,nsub1,1,icall,memuse)
      call umalloc(ip_iiint2,nsub1,1,icall,memuse)
      call umalloc(ip_jimage,msub1*(mptch+2)*(mptch+2),1,icall,memuse)
      call umalloc(ip_kimage,msub1*(mptch+2)*(mptch+2),1,icall,memuse)
      call umalloc(ip_jte,msub1,1,icall,memuse)
      call umalloc(ip_kte,msub1,1,icall,memuse)
      call umalloc(ip_jmm,mptch+2,1,icall,memuse)
      call umalloc(ip_kmm,mptch+2,1,icall,memuse)
      call umalloc(ip_nblk1,mptch+2,1,icall,memuse)
      call umalloc(ip_nblk2,mptch+2,1,icall,memuse)
      call umalloc(ip_xte,msub1*(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_yte,msub1*(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_zte,msub1*(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_xmi,msub1*(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_ymi,msub1*(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_zmi,msub1*(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_xmie,msub1*(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_ymie,msub1*(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_zmie,msub1*(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_sxie,msub1*(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_seta,msub1*(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_sxie2,(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_seta2,(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_xie2s,(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_eta2s,(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_temp,(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_x2,(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_y2,(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_z2,(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_x1,(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_y1,(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_z1,(mptch+2)*(mptch+2),0,icall,memuse)
      call umalloc(ip_factjlo,intmx*msub1,0,icall,memuse)
      call umalloc(ip_factjhi,intmx*msub1,0,icall,memuse)
      call umalloc(ip_factklo,intmx*msub1,0,icall,memuse)
      call umalloc(ip_factkhi,intmx*msub1,0,icall,memuse)
      call umalloc(ip_ifrom,msub1,0,icall,memuse)
      call umalloc(ip_geom_miss,2*mxbli,0,icall,memuse)
      call umalloc(ip_period_miss,lbcprd,0,icall,memuse)
      call umalloc(ip_isav_blk,34*mxbli,1,icall,memuse)
      call umalloc(ip_isav_prd,12*lbcprd,1,icall,memuse)
      call umalloc(ip_isav_pat,17*intmax,1,icall,memuse)
      call umalloc(ip_isav_pat_b,6*intmax*nsub1,1,icall,memuse)
      call umalloc(ip_isav_dpat,17*intmx,1,icall,memuse)
      call umalloc(ip_isav_dpat_b,6*intmx*msub1,1,icall,memuse)
      call umalloc(ip_isav_emb,12*lbcemb,1,icall,memuse)
      call umalloc(ip_mblk2nd,maxbl,1,icall,memuse)
      call umalloc(ip_istat2_bl,istat_size*mxbli*5,1,icall,memuse)
      call umalloc(ip_istat2_pa,istat_size*intmax*nsub1*3,1,icall,
     .             memuse)
      call umalloc(ip_istat2_pe,istat_size*lbcprd*5,1,icall,memuse)
      call umalloc(ip_istat2_em,istat_size*lbcemb*3,1,icall,memuse)
      call umalloc(ip_utrnsae,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_vtrnsae,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_wtrnsae,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_omgxae,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_omgyae,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_omgzae,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_xorgae,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_yorgae,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_zorgae,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_xorgae0,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_yorgae0,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_zorgae0,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_icouple,maxbl*maxsegdg,1,icall,memuse)
      call umalloc(ip_thtxae,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_thtyae,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_thtzae,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_rfrqtae,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_rfrqrae,maxbl*maxsegdg,0,icall,memuse)
      call umalloc(ip_icsi,maxbl*maxsegdg,1,icall,memuse)
      call umalloc(ip_icsf,maxbl*maxsegdg,1,icall,memuse)
      call umalloc(ip_jcsi,maxbl*maxsegdg,1,icall,memuse)
      call umalloc(ip_jcsf,maxbl*maxsegdg,1,icall,memuse)
      call umalloc(ip_kcsi,maxbl*maxsegdg,1,icall,memuse)
      call umalloc(ip_kcsf,maxbl*maxsegdg,1,icall,memuse)
      call umalloc(ip_nsegdfrm,maxbl,1,icall,memuse)
      call umalloc(ip_idfrmseg,maxbl*maxsegdg,1,icall,memuse)
      call umalloc(ip_iaesurf,maxbl*maxsegdg,1,icall,memuse)
      call umalloc(ip_freq,nmds*maxaes,0,icall,memuse)
      call umalloc(ip_gmass,nmds*maxaes,0,icall,memuse)
      call umalloc(ip_x0,2*nmds*maxaes,0,icall,memuse)
      call umalloc(ip_gf0,2*nmds*maxaes,0,icall,memuse)
      call umalloc(ip_damp,nmds*maxaes,0,icall,memuse)
      call umalloc(ip_perturb,4*nmds*maxaes,0,icall,memuse)
      call umalloc(ip_aesrfdat,5*maxaes,0,icall,memuse)
      call umalloc(ip_slavept,15*nslave*nmaster,0,icall,memuse)
      call umalloc(ip_iskip,maxbl,1,icall,memuse)
      call umalloc(ip_jskip,maxbl,1,icall,memuse)
      call umalloc(ip_kskip,maxbl,1,icall,memuse)
      call umalloc(ip_bmat,2*nmds*2*nmds*maxaes,0,icall,memuse)
      call umalloc(ip_stm,2*nmds*2*nmds*maxaes,0,icall,memuse)
      call umalloc(ip_stmi,2*nmds*2*nmds*maxaes,0,icall,memuse)
      call umalloc(ip_xs,2*nmds*maxaes,0,icall,memuse)
      call umalloc(ip_xxn,2*nmds*maxaes,0,icall,memuse)
      call umalloc(ip_gforcn,2*nmds*maxaes,0,icall,memuse)
      call umalloc(ip_gforcnm,2*nmds*maxaes,0,icall,memuse)
      call umalloc(ip_gforcs,2*nmds*maxaes,0,icall,memuse)
      call umalloc(ip_aehist,ncycmax*3*nmds*maxaes,0,icall,memuse)
      call umalloc(ip_timekeep,ncycmax,0,icall,memuse)
c
c***********************************************************************
c     initiialize output buffer
c***********************************************************************
c
      do ii=1,nbuf
         nou(ii) = 0
         do mm=1,ibufdim
            bou(mm,ii) = ' '
         end do
      end do
c
c***********************************************************************
c     call flow solver
c***********************************************************************
c
      call mgbl(mwork,mworki,nplots,minnode,iitot,intmax,maxxe,
     .          mxbli,nsub1,lbcprd,lbcemb,lbcrad,maxbl,maxgr,
     .          maxseg,maxcs,ncycmax,intmx,mxxe,mptch,msub1,
     .          ibufdim,nbuf,mxbcfil,istat_size,
     .          work,iwork,lwdat,lw,lw2,nou,bou,bcfilei,
     .          bcfilej,bcfilek,istat2_bl,istat2_pa,istat2_em,
     .          istat2_pe,nblk,limblk,isva,nblon,resmx,imx,
     .          jmx,kmx,vormax,ivmax,jvmax,kvmax,lig,lbg,
     .          iovrlp,qb,ibpntsg,iipntsg,iibg,kkbg,jjbg,ibcg,
     .          dxintg,dyintg,dzintg,iiig,jjig,kkig,rkap0g,
     .          levelg,igridg,iflimg,ifdsg,iviscg,jdimg,
     .          kdimg,idimg,idiagg,nblcg,idegg,jsg,ksg,isg,
     .          jeg,keg,ieg,mit,ilamlog,ilamhig,jlamlog,
     .          jlamhig,klamlog,klamhig,iwfg,utrans,vtrans,
     .          wtrans,omegax,omegay,omegaz,xorig,yorig,
     .          zorig,dxmx,dymx,dzmx,dthxmx,dthymx,dthzmx,
     .          thetax,thetay,thetaz,rfreqt,rfreqr,xorig0,
     .          yorig0,zorig0,time2,thetaxl,thetayl,thetazl,
     .          itrans,irotat,idefrm,bcvali,bcvalj,bcvalk,nbci0,
     .          nbcidim,nbcj0,nbcjdim,nbck0,nbckdim,ibcinfo,
     .          jbcinfo,kbcinfo,ncgg,nblg,iemg,inewgg,
     .          inpl3d,inpr,iadvance,iforce,rms,clw,cdw,
     .          cdpw,cdvw,cxw,cyw,czw,cmxw,cmyw,cmzw,chdw,
     .          swetw,fmdotw,cfttotw,cftmomw,cftpw,cftvw,
     .          rmstr1,rmstr2,nneg1,nneg2,swett,clt,cdt,cxt,
     .          cyt,czt,cmxt,cmyt,cmzt,cdpt,cdvt,sx,sy,sz,
     .          stot,pav,ptav,tav,ttav,xmav,fmdot,cfxp,cfyp,
     .          cfzp,cfdp,cflp,cftp,cfxv,cfyv,cfzv,cfdv,cflv,
     .          cftv,cfxmom,cfymom,cfzmom,cfdmom,cflmom,
     .          cftmom,cfxtot,cfytot,cfztot,cfdtot,cfltot,
     .          cfttot,icsinfo,windex,iindex,nblkpt,windx,
     .          iindx,llimit,iitmax,mmcxie,mmceta,ncheck,
     .          iifit,mblkpt,iic0,iiorph,iitoss,ifiner,
     .          dthetxx,dthetyy,dthetzz,dx,dy,dz,dthetx,
     .          dthety,dthetz,lout,xif1,xif2,etf1,etf2,
     .          jjmax1,kkmax1,iiint1,iiint2,jimage,kimage,
     .          jte,kte,jmm,kmm,nblk1,nblk2,xte,yte,zte,xmi,
     .          ymi,zmi,xmie,ymie,zmie,sxie,seta,sxie2,
     .          seta2,xie2s,eta2s,temp,x2,y2,z2,x1,y1,z1,
     .          factjlo,factjhi,factklo,factkhi,ifrom,
     .          geom_miss,period_miss,isav_blk,isav_prd,
     .          isav_pat,isav_pat_b,isav_dpat,isav_dpat_b,
     .          isav_emb,mblk2nd,ntr,utrnsae,vtrnsae,wtrnsae,
     .          omgxae,omgyae,omgzae,xorgae,yorgae,zorgae,thtxae,
     .          thtyae,thtzae,rfrqtae,rfrqrae,icsi,icsf,jcsi,jcsf,
     .          kcsi,kcsf,freq,gmass,damp,x0,gf0,nmds,maxaes,
     .          aesrfdat,perturb,memuse,bcfiles,slavept,nslave,
     .          iskip,jskip,kskip,bmat,stm,stmi,xs,xxn,gforcn,
     .          gforcnm,gforcs,nsegdfrm,idfrmseg,iaesurf,maxsegdg,
c    .          nmaster,aehist,timekeep)
     .          nmaster,aehist,timekeep,xorgae0,yorgae0,zorgae0,
     .          icouple)
c
c***********************************************************************
c     deallocate memory 
c***********************************************************************
c
c     freeing up the memory at this stage is not really necessary,
c     but it is a VERY good check for code errors that are otherwise
c     hard to detect - if an array has been allocated incorrectly,
c     or the array bounds have been exceeded, then the memory 
c     deallocation will fail.
c
      ifree = 1
      if (ifree.gt.0) then
         call ufree(ip_work)
         call ufree(ip_iwork)
         call ufree(ip_lwdat)
         call ufree(ip_lw)
         call ufree(ip_lw2)
         call ufree(ip_nblk)
         call ufree(ip_limblk)
         call ufree(ip_isva)
         call ufree(ip_nblon)
         call ufree(ip_resmx)
         call ufree(ip_imx)
         call ufree(ip_jmx)
         call ufree(ip_kmx)
         call ufree(ip_vormax)
         call ufree(ip_ivmax)
         call ufree(ip_jvmax)
         call ufree(ip_kvmax)
         call ufree(ip_lig)
         call ufree(ip_lbg)
         call ufree(ip_iovrlp)
         call ufree(ip_qb)
         call ufree(ip_ibpntsg)
         call ufree(ip_iipntsg)
         call ufree(ip_iibg)
         call ufree(ip_jjbg)
         call ufree(ip_kkbg)
         call ufree(ip_ibcg)
         call ufree(ip_dxintg)
         call ufree(ip_dyintg)
         call ufree(ip_dzintg)
         call ufree(ip_iiig)
         call ufree(ip_jjig)
         call ufree(ip_kkig)
         call ufree(ip_rkap0g)
         call ufree(ip_levelg)
         call ufree(ip_igridg)
         call ufree(ip_iflimg)
         call ufree(ip_ifdsg)
         call ufree(ip_iviscg)
         call ufree(ip_jdimg)
         call ufree(ip_kdimg)
         call ufree(ip_idimg)
         call ufree(ip_idiagg)
         call ufree(ip_nblcg)
         call ufree(ip_idegg)
         call ufree(ip_jsg)
         call ufree(ip_ksg)
         call ufree(ip_isg)
         call ufree(ip_jeg)
         call ufree(ip_keg)
         call ufree(ip_ieg)
         call ufree(ip_mit)
         call ufree(ip_jlamlog)
         call ufree(ip_klamlog)
         call ufree(ip_ilamlog)
         call ufree(ip_jlamhig)
         call ufree(ip_klamhig)
         call ufree(ip_ilamhig)
         call ufree(ip_iwfg)
         call ufree(ip_utrans)
         call ufree(ip_vtrans)
         call ufree(ip_wtrans)
         call ufree(ip_omegax)
         call ufree(ip_omegay)
         call ufree(ip_omegaz)
         call ufree(ip_xorig)
         call ufree(ip_yorig)
         call ufree(ip_zorig)
         call ufree(ip_dxmx)
         call ufree(ip_dymx)
         call ufree(ip_dzmx)
         call ufree(ip_dthxmx)
         call ufree(ip_dthymx)
         call ufree(ip_dthzmx)
         call ufree(ip_thetax)
         call ufree(ip_thetay)
         call ufree(ip_thetaz)
         call ufree(ip_rfreqt)
         call ufree(ip_rfreqr)
         call ufree(ip_xorig0)
         call ufree(ip_yorig0)
         call ufree(ip_zorig0)
         call ufree(ip_time2)
         call ufree(ip_thetaxl)
         call ufree(ip_thetayl)
         call ufree(ip_thetazl)
         call ufree(ip_itrans)
         call ufree(ip_irotat)
         call ufree(ip_idefrm)
         call ufree(ip_bcvali)
         call ufree(ip_bcvalj)
         call ufree(ip_bcvalk)
         call ufree(ip_nbci0)
         call ufree(ip_nbcj0)
         call ufree(ip_nbck0)
         call ufree(ip_nbcidim)
         call ufree(ip_nbcjdim)
         call ufree(ip_nbckdim)
         call ufree(ip_ibcinfo)
         call ufree(ip_jbcinfo)
         call ufree(ip_kbcinfo)
         call ufree(ip_bcfilei)
         call ufree(ip_bcfilej)
         call ufree(ip_bcfilek)
         call ufree(ip_ncgg)
         call ufree(ip_nblg)
         call ufree(ip_iemg)
         call ufree(ip_inewgg)
         call ufree(ip_inpl3d)
         call ufree(ip_inpr)
         call ufree(ip_iadvance)
         call ufree(ip_iforce)
         call ufree(ip_rms)
         call ufree(ip_clw)
         call ufree(ip_cdw)
         call ufree(ip_cdpw)
         call ufree(ip_cdvw)
         call ufree(ip_cxw)
         call ufree(ip_cyw)
         call ufree(ip_czw)
         call ufree(ip_cmxw)
         call ufree(ip_cmyw)
         call ufree(ip_cmzw)
         call ufree(ip_chdw)
         call ufree(ip_swetw)
         call ufree(ip_fmdotw)
         call ufree(ip_cfttotw)
         call ufree(ip_cftmomw)
         call ufree(ip_cftpw)
         call ufree(ip_cftvw)
         call ufree(ip_rmstr1)
         call ufree(ip_rmstr2)
         call ufree(ip_nneg1)
         call ufree(ip_nneg2)
         call ufree(ip_swett)
         call ufree(ip_clt)
         call ufree(ip_cdt)
         call ufree(ip_cxt)
         call ufree(ip_cyt)
         call ufree(ip_czt)
         call ufree(ip_cmxt)
         call ufree(ip_cmyt)
         call ufree(ip_cmzt)
         call ufree(ip_cdpt)
         call ufree(ip_cdvt)
         call ufree(ip_sx)
         call ufree(ip_sy)
         call ufree(ip_sz)
         call ufree(ip_stot)
         call ufree(ip_pav)
         call ufree(ip_ptav)
         call ufree(ip_tav)
         call ufree(ip_ttav)
         call ufree(ip_xmav)
         call ufree(ip_fmdot)
         call ufree(ip_cfxp)
         call ufree(ip_cfyp)
         call ufree(ip_cfzp)
         call ufree(ip_cfdp)
         call ufree(ip_cflp)
         call ufree(ip_cftp)
         call ufree(ip_cfxv)
         call ufree(ip_cfyv)
         call ufree(ip_cfzv)
         call ufree(ip_cfdv)
         call ufree(ip_cflv)
         call ufree(ip_cftv)
         call ufree(ip_cfxmom)
         call ufree(ip_cfymom)
         call ufree(ip_cfzmom)
         call ufree(ip_cfdmom)
         call ufree(ip_cflmom)
         call ufree(ip_cftmom)
         call ufree(ip_cfxtot)
         call ufree(ip_cfytot)
         call ufree(ip_cfztot)
         call ufree(ip_cfdtot)
         call ufree(ip_cfltot)
         call ufree(ip_cfttot)
         call ufree(ip_icsinfo)
         call ufree(ip_windex)
         call ufree(ip_iindex)
         call ufree(ip_nblkpt)
         call ufree(ip_windx)
         call ufree(ip_iindx)
         call ufree(ip_llimit)
         call ufree(ip_iitmax)
         call ufree(ip_mmcxie)
         call ufree(ip_mmceta)
         call ufree(ip_ncheck)
         call ufree(ip_iifit)
         call ufree(ip_mblkpt)
         call ufree(ip_iic0)
         call ufree(ip_iiorph)
         call ufree(ip_iitoss)
         call ufree(ip_ifiner)
         call ufree(ip_dthetxx)
         call ufree(ip_dthetyy)
         call ufree(ip_dthetzz)
         call ufree(ip_dx)
         call ufree(ip_dy)
         call ufree(ip_dz)
         call ufree(ip_dthetx)
         call ufree(ip_dthety)
         call ufree(ip_dthetz)
         call ufree(ip_lout)
         call ufree(ip_xif1)
         call ufree(ip_xif2)
         call ufree(ip_etf1)
         call ufree(ip_etf2)
         call ufree(ip_jjmax1)
         call ufree(ip_kkmax1)
         call ufree(ip_iiint1)
         call ufree(ip_iiint2)
         call ufree(ip_jimage)
         call ufree(ip_kimage)
         call ufree(ip_jte)
         call ufree(ip_kte)
         call ufree(ip_jmm)
         call ufree(ip_kmm)
         call ufree(ip_nblk1)
         call ufree(ip_nblk2)
         call ufree(ip_xte)
         call ufree(ip_yte)
         call ufree(ip_zte)
         call ufree(ip_xmi)
         call ufree(ip_ymi)
         call ufree(ip_zmi)
         call ufree(ip_xmie)
         call ufree(ip_ymie)
         call ufree(ip_zmie)
         call ufree(ip_sxie)
         call ufree(ip_seta)
         call ufree(ip_sxie2)
         call ufree(ip_seta2)
         call ufree(ip_xie2s)
         call ufree(ip_eta2s)
         call ufree(ip_temp)
         call ufree(ip_x2)
         call ufree(ip_y2)
         call ufree(ip_z2)
         call ufree(ip_x1)
         call ufree(ip_y1)
         call ufree(ip_z1)
         call ufree(ip_factjlo)
         call ufree(ip_factjhi)
         call ufree(ip_factklo)
         call ufree(ip_factkhi)
         call ufree(ip_ifrom)
         call ufree(ip_geom_miss)
         call ufree(ip_period_miss)
         call ufree(ip_isav_blk)
         call ufree(ip_isav_prd)
         call ufree(ip_isav_pat)
         call ufree(ip_isav_pat_b)
         call ufree(ip_isav_dpat)
         call ufree(ip_isav_dpat_b)
         call ufree(ip_isav_emb)
         call ufree(ip_mblk2nd)
         call ufree(ip_istat2_bl)
         call ufree(ip_istat2_pa)
         call ufree(ip_istat2_pe)
         call ufree(ip_istat2_em)
         call ufree(ip_utrnsae)
         call ufree(ip_vtrnsae)
         call ufree(ip_wtrnsae)
         call ufree(ip_omgxae)
         call ufree(ip_omgyae)
         call ufree(ip_omgzae)
         call ufree(ip_xorgae)
         call ufree(ip_yorgae)
         call ufree(ip_zorgae)
         call ufree(ip_xorgae0)
         call ufree(ip_yorgae0)
         call ufree(ip_zorgae0)
         call ufree(ip_icouple)
         call ufree(ip_thtxae)
         call ufree(ip_thtyae)
         call ufree(ip_thtzae)
         call ufree(ip_rfrqtae)
         call ufree(ip_rfrqrae)
         call ufree(ip_icsi)
         call ufree(ip_icsf)
         call ufree(ip_jcsi)
         call ufree(ip_jcsf)
         call ufree(ip_kcsi)
         call ufree(ip_kcsf)
         call ufree(ip_nsegdfrm)
         call ufree(ip_idfrmseg)
         call ufree(ip_iaesurf)
         call ufree(ip_freq)
         call ufree(ip_gmass)
         call ufree(ip_x0)
         call ufree(ip_gf0)
         call ufree(ip_damp)
         call ufree(ip_perturb)
         call ufree(ip_aesrfdat)
         call ufree(ip_slavept)
         call ufree(ip_iskip)
         call ufree(ip_jskip)
         call ufree(ip_kskip)
         call ufree(ip_bmat)
         call ufree(ip_stm)
         call ufree(ip_stmi)
         call ufree(ip_xs)
         call ufree(ip_xxn)
         call ufree(ip_gforcn)
         call ufree(ip_gforcnm)
         call ufree(ip_gforcs)
         call ufree(ip_aehist)
         call ufree(ip_timekeep)
         if (myid.eq.myhost) then
            write(11,'(/,'' memory for cfl3d has been deallocated'')')
         end if
      end if
c
      return
      end
